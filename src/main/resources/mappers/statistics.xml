<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bewellnesspring.statistics.repository.statisticsRepository">

    <select id="selectSport" parameterType="map" resultType="map">
        SELECT
        TIMESTAMPDIFF(SECOND, B.routine_start, B.routine_end) / 60.0 AS sport_time,
        C.sport_name,
        B.set_count,
        B.sport_count
        FROM
        sport_routine A
        LEFT OUTER JOIN
        sport_routine_list B ON A.id = B.sport_routine_id
        LEFT OUTER JOIN
        sport_category C ON B.sport_category_id = C.id
        WHERE
        B.routine_start >= DATE_SUB(CURDATE(), INTERVAL (WEEKDAY(CURDATE()) + 7) DAY)
        AND B.routine_start $lt; DATE_SUB(CURDATE(), INTERVAL WEEKDAY(CURDATE()) DAY);

    </select>

    <select id="selectKcal" parameterType="map" resultType="map">
        SELECT sum(B.amount*F.kcal) as meal_kcal,
        sum(TIMESTAMPDIFF(SECOND, B.routine_start, B.routine_end) /60.0*D.kcal) as sport_kcal,
        sum(G.kcal_plan_amount) as kcalplan,
        FROM users U
        LEFT OUTER JOIN meal A ON U.id = A.user_id
        LEFT OUTER JOIN meal_detail B ON A.meal_id = B.meal_id
        LEFT OUTER JOIN sport_routine C ON A.user_id = C.user_id
        LEFT OUTER JOIN sport_routine_list D ON C.id = D.sport_routine_id
        LEFT OUTER JOIN sport_category E ON E.id = D.sport_category_id
        LEFT OUTER JOIN food_category F ON F.id = B.food_id
        LEFT OUTER JOIN plan G ON U.id = G.user_id
        WHERE
        B.routine_start >= DATE_SUB(CURDATE(), INTERVAL (WEEKDAY(CURDATE()) + 7) DAY)
        AND B.routine_start $lt; DATE_SUB(CURDATE(), INTERVAL WEEKDAY(CURDATE()) DAY);
        GROUP BY U.id, DATE(B.routine_start);

    </select>

    <select id="selectFood" parameterType="map" resultType="map">
        SELECT sum(B.amount*F.kcal) as meal_kcal,
        sum(B.amount*F.na) as meal_na,
        sum(B.amount*F.protein) as meal_protein,
        sum(B.amount*F.fiber) as meal_fiber,
        sum(B.amount*F.fat) as meal_fat,
        sum(B.amount*F.cholesterol) as meal_cholesterol,
        sum(B.amount*F.carbohydrate) as meal_carbohydrate,
        sum(TIMESTAMPDIFF(SECOND, B.routine_start, B.routine_end) /60.0*D.kcal) as sport_kcal,
        sum(G.kcal_plan_amount) as kcalplan,
        sum(G.na_plan_amount) as naplan,
        sum(G.protein_plan_amount) as proteinplan,
        sum(G.fiber_plan_amount) as fiberplan,
        sum(G.fat_plan_amount) as fatplan,
        sum(G.cholesterol_plan_amount) as cholesterolplan,
        sum(G.carbohydrate_plan_amount) as carbohydrateplan,
        FROM users U
        LEFT OUTER JOIN meal A ON U.id = A.user_id
        LEFT OUTER JOIN meal_detail B ON A.meal_id = B.meal_id
        LEFT OUTER JOIN sport_routine C ON A.user_id = C.user_id
        LEFT OUTER JOIN sport_routine_list D ON C.id = D.sport_routine_id
        LEFT OUTER JOIN sport_category E ON E.id = D.sport_category_id
        LEFT OUTER JOIN food_category F ON F.id = B.food_id
        LEFT OUTER JOIN plan G ON U.id = G.user_id
        WHERE
        B.routine_start >= DATE_SUB(CURDATE(), INTERVAL (WEEKDAY(CURDATE()) + 7) DAY)
        AND B.routine_start $lt; DATE_SUB(CURDATE(), INTERVAL WEEKDAY(CURDATE()) DAY);
        GROUP BY U.id, DATE(B.routine_start);
    </select>
    <select id="selectLevel" parameterType="map" resultType="map">
        SELECT SUM(TIMESTAMPDIFF(SECOND, B.routine_start, B.routine_end) /60.0) as sport_time,
               B.sport_name
        FROM sport_routine O
        LEFT OUTER JOIN sport_routine_list A ON A.sport_routine_id = O.id
        LEFT OUTER JOIN sport_category B ON A.sport_category_id = B.id
        WHERE A.routine_start >= DATE_SUB(CURDATE(), INTERVAL (WEEKDAY(CURDATE()) + 7) DAY)
        AND A.routine_start $lt; DATE_SUB(CURDATE(), INTERVAL WEEKDAY(CURDATE()) DAY);
        GROUP BY O.user_id, B.sport_name
    </select>
    <select id="selectAll" parameterType="map" resultType="map">
        SELECT sum(B.amount*F.kcal) as meal_kcal,
        sum(B.amount*F.na) as meal_na,
        sum(B.amount*F.protein) as meal_protein,
        sum(B.amount*F.fiber) as meal_fiber,
        sum(B.amount*F.fat) as meal_fat,
        sum(B.amount*F.cholesterol) as meal_cholesterol,
        sum(B.amount*F.carbohydrate) as meal_carbohydrate,
        sum(TIMESTAMPDIFF(SECOND, B.routine_start, B.routine_end) /60.0*D.kcal) as sport_kcal,

        FROM users U
        LEFT OUTER JOIN meal A ON U.id = A.user_id
        LEFT OUTER JOIN meal_detail B ON A.meal_id = B.meal_id
        LEFT OUTER JOIN sport_routine C ON A.user_id = C.user_id
        LEFT OUTER JOIN sport_routine_list D ON C.id = D.sport_routine_id
        LEFT OUTER JOIN sport_category E ON E.id = D.sport_category_id
        LEFT OUTER JOIN food_category F ON F.id = B.food_id
        LEFT OUTER JOIN plan G ON U.id = G.user_id
        WHERE
        B.routine_start >= DATE_SUB(CURDATE(), INTERVAL (WEEKDAY(CURDATE()) + 7) DAY)
        AND B.routine_start $lt; DATE_SUBCURDATE(), INTERVAL WEEKDAY(CURDATE()) DAY);
        GROUP BY U.id, DATE(B.routine_start);
    </select>

</mapper>